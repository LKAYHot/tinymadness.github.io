jQuery(document).ready(function($) {

    /* ======= Scrollspy ======= */
    $('body').scrollspy({ target: '#header', offset: 400});
    
    /* ======= Fixed header when scrolled ======= */
    
    $(window).bind('scroll', function() {
         if ($(window).scrollTop() > 50) {
             $('#header').addClass('navbar-fixed-top');
         }
         else {
             $('#header').removeClass('navbar-fixed-top');
         }
    });
   
    /* ======= ScrollTo ======= */
    $('a.scrollto').on('click', function(e){
        // Проверяем, является ли ссылка внешней (не ведущей на текущий сайт)
        if (this.hostname !== window.location.hostname) {
            // Если ссылка ведет на другой сайт, просто переходим по ссылке
            return true;
        }
        
        // Если ссылка ведет на текущий сайт, предотвращаем стандартное поведение перехода по ссылке
        e.preventDefault();

        // Получаем URL из атрибута href ссылки, по которой кликнули
        var targetUrl = $(this).attr('href');

        // Переходим по указанному URL
        window.location.href = targetUrl;
    });

    

});

function scrollToAbout() {
    var aboutSection = document.getElementById('about');
    aboutSection.scrollIntoView({ behavior: 'smooth' });
}

function generateDates() {
  let dates = [];
  let currentDate = new Date();
  for (let i = 0; i < 7; i++) {
      let nextDate = new Date(currentDate);
      nextDate.setDate(currentDate.getDate() + i);
      dates.push(nextDate);
  }
  return dates;
}


const Skj3lsdkjmskka324235346545hhjthasdasdrthgpgreewtwteFgfeggergergegdfhrhnrnr = 'Sjkjmkdll21ldlz';
const Skj3lsdkjmskka324235346545hhjthAsdasdrthgfgreEwtwtefgfeggergergegdfhrhnrnr = 'Lkjdf-33b1z';
const Skj3lsdkjmskka324235346545hhjthasdasdrthgfgreewtwteFgfeggergergeGdfhrhnrnr = 'z2LdK9Plp2';
const Skj3lsdkjmskka324235346545hhjthasDasdrthgfgreewtwtefgfeggergergegdfHrhnrnr = 'DwL12o';
const Skj3lsdkjmskka324235346545hhjthasdasdrthgfgreEwtwtefgfeggergergegdfhrhnrnr = 'QHt46BXiu';
const Skj3lsdkjmskka324235346545hhjthasAasdrthgfgreewtwtefgfeggergergegdfhrhnrnr = 'MjLzaBzH';
const Skj3lsdkjmskka324235346545hhjthaSdasdrthgfgreEwtwtefgfeggergergegdfhrhnrnr = 'Pqo89JZs';
const Skj3lsdkjmskka324235346545hhjthasdasdrthgfgreewtwteFgfeggergeRgegdfhrhnrnr = 'Q8a9-BLoiH';
const Skj3lsdkjmskka324235346545hhjthasHasdrthgfgreewtwtefgfeggergergegdfHrhnrnr = 'ZcHk21R';
const Skj3lsdkjmskka324235346545hhjthasdasdrthgfgreewtwtefgfeggergergegdfHrhnrnr = 'DCmFLw';
const Skj3lsdkjmskka324235346545hhjthasdasdrthggfreewtwtefgfeggergergegdfhrhnrnr = 'Sx8vJZpaK';
const Skj3lsdkjmskka324235346545hhjthasdasdrthgfGreEwtwtefgfeggergergegdfhrhnrnr = 'QoV31BbG';
const Skj3lsdkjmskka324235346545hhjthasdasdrthgfZreewtwteFgfeggergergegdfhrhnrnr = '-Xo2aHjUzI';
const Skj3lsdkjmskka324235346545hhjtahsdasdrthgfgreewtwtefgfeggergergegdfHrhnrnr = 'D9aRfLc';
const Skj3lsdkjmskka324235346545hhjthasdasdrthgfgreewtwtefgfeggergergegdfhrhnrnR = 'N2aQy3bZo';
const Skj3lsdkjmskka324235346545hhjthasdasdrthgfgreewtwtefgfeggergergegdfhrhnrnr = 'AIzaSyBpZDuGw2';
const Skj3lsdkjmskka314235346545hhjthasdasdrthgfgreEwtwtefgfeggergergegdfhrhnrnr = 'ZbLpPw6';
const Skj3lsdkjmskka324235346545hhjtha1dasdrthgfgreewtwteFgfeggergergegdfhrhnrnr = 'S3mJ4kHl';
const Skj3lsdkjmskka324235346545hhjthasdasdrthgfgreewttwefgfeggergergegdfHrhnrnr = '-B2nLx9zP';
const Skj3lsdkjmskka324235346545hhjthasdasdrthgfgrewetwtefgfeggergergegdfhrhnrnr = 'WzL1oHbZ';
const Skj3lsdkjmskka324235331545hhjthasdasdrthgfgreEwtwtefgfeggergergegdfhrhnrnr = 'Qp2t4zFb';
const Skj3lsdkjmskka324235346545hhjthasdasdrthgfgreewtwteFgfeggergergegdfhrhnrnr = '-9lKhLIiHk';
const Skj3lsdkmjskka324235346545hhjthasdasdrthgfgreewtwteFgfeggergergegdfhrhnrnr = 'J1oT8pBz';
const Skj3lsdkjmskka324235346545hhjtihasdasdrthgfgreewtwtefgfeggergergegdfHrhnrn = 'Z2f1Lb4';


const Skj3lsdkjmskka324235346545hhjtShAasdasdrthgfGreEwtwtefgfeggergergegdfhrhnrnr = `${Skj3lsdkjmskka324235346545hhjthasdasdrthgfgreewtwtefgfeggergergegdfhrhnrnR}${Skj3lsdkjmskka324235346545hhjtihasdasdrthgfgreewtwtefgfeggergergegdfHrhnrn}${Skj3lsdkjmskka324235346545hhjthasdasdrthgpgreewtwteFgfeggergergegdfhrhnrnr}${Skj3lsdkjmskka314235346545hhjthasdasdrthgfgreEwtwtefgfeggergergegdfhrhnrnr}`;

const Skj3lsdkjmskka324235346545hhjthAasdasdrthgfGreEwtwtefgfeggergergegdfhrhnrnr = `${Skj3lsdkjmskka324235346545hhjthasdasdrthgfgreewtwtefgfeggergergegdfhrhnrnr}${Skj3lsdkjmskka324235346545hhjthasdasdrthgfgreEwtwtefgfeggergergegdfhrhnrnr}${Skj3lsdkjmskka324235346545hhjthasdasdrthgfgreewtwteFgfeggergergegdfhrhnrnr}${Skj3lsdkjmskka324235346545hhjthasdasdrthgfgreewtwtefgfeggergergegdfHrhnrnr}`;

const SPREADSHEET_ID = '1Tk-wPeOq_oxqIS807tVHORAXz3kGJ8d9xkPzE2z0rxQ';

function readDataFromGoogleSheets(callback) {
  const RANGE = 'A2:F9'; 

  fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${RANGE}?key=${Skj3lsdkjmskka324235346545hhjthAasdasdrthgfGreEwtwtefgfeggergergegdfhrhnrnr}`)
      .then(response => {
          if (!response.ok) {
              throw new Error(`Network response was not ok: ${response.status} ${response.statusText}`);
          }
          return response.json();
      })
      .then(data => {
          const formattedData = data.values.map(row => ({
              x: new Date(row[0]).getTime(),
              y: parseFloat(row[1])
          }));

          const additionalData = data.values.slice(0, 6).map(row => ({
              label: row[2],
              value: parseFloat(row[3])
          }));

          const additionalData1 = data.values.slice(0, 6).map(row => ({
            label: row[4],
            value: parseFloat(row[5])
        }));

          callback(formattedData, additionalData, additionalData1);
          console.log('DataNew:', formattedData);
      })
      .catch(error => {
          console.error('Error reading data:', error);
      });
}

function updateAdditionalData(additionalData, additionalData1) {
  console.log('Additional Data:', additionalData);
  console.log('Additional Data1:', additionalData1);

  additionalData1.forEach((item, index) => {
    const percentElement1 = document.querySelectorAll('.bar')[index];
    if (percentElement1) {
      const fillElement = percentElement1.querySelector('.fill');

      const labelElement = percentElement1.querySelector('.label');

      labelElement.innerText = `${item.label} ${item.value}%`;
      console.log('ElementMain:', fillElement);

      fillElement.style.height = item.value + '%';

      console.log('ElementMain:', fillElement.style.height);
  }
  });

  additionalData.forEach((item, index) => {
      const element = document.querySelector(`.sub-title[data-lang="${item.label}"]`);
      const percentElement = document.querySelectorAll('.plotpercent')[index];

      if (percentElement)
      {
        const valueWithPlus = item.value + '%' + ' ' + '+ 1%';
        const greenPlus = `<span style="color: green;">+ 1%</span>`;
        percentElement.innerHTML = valueWithPlus.replace('+ 1%', greenPlus);
      }

      if (element) {
          const percent = item.value.toFixed(2) + '%';
          const fillHeight = item.value + '%';
          const progressbar = document.querySelector(`.progress-barstatusquary:nth-child(${index + 1})`);

          element.nextElementSibling.innerText = percent; 
          progressbar.style.width = percent;
      }
  });

  document.documentElement.style.setProperty('--first-value', additionalData[0].value + '%');
  document.documentElement.style.setProperty('--second-value', additionalData[1].value + '%');
  document.documentElement.style.setProperty('--third-value', additionalData[2].value + '%');

  const percentElementExtended = document.querySelectorAll('.plotpercent')[3];
  percentElementExtended.textContent = additionalData[2].value + '%' + ' ' + ' + 1%';
}

var options = {
    chart: {
        locales: [{
            "name": "ru",
            "options": {
              "months": ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
              "shortMonths": ["Января", "Февраля", "Марта", "Апреля", "Мая", "Июня", "Июля", "Августа", "Сентября", "Октября", "Ноября", "Декабря"],
              "days": ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
              "shortDays": ["Вс", "Mon", "Tue", "Wed", "Thu", "Fri", "Суб"],
            }
          }],
          defaultLocale: "ru",

      type: 'line',
      foreColor: '#347cd5',
      toolbar: {
        show: false,
      },
      zoom: {
        enabled: false,
      }
      
    },
    stroke: {
        curve: 'smooth',
        width: 2,
      },
      markers: {
        size: 3,
    },
    series: [{
      name: 'Количество строк',
      data: []
  }], 
      legend: {
        position: 'top',
        horizontalAlign: 'right',
        offsetY: -10,
        labels: {
          colors: '#347cd5',
        },
      },
      xaxis: {
        type: 'datetime'
      }  
    
  }

  
  
  document.addEventListener("DOMContentLoaded", function() {
    var chart = new ApexCharts(document.querySelector("#line-chart"), options);
    readDataFromGoogleSheets((data, additionalData, additionalData1) => {
        chart.updateSeries([{
            data: data
        }]);
        updateAdditionalData(additionalData, additionalData1);
    });
    chart.render();
});